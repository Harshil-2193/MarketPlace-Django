{% extends "layout.html" %}
{% load form_filters %}
{% load static %}
{% block title %}{{title}}{% endblock title %}

{% block content %}
<div class="bg-gradient-to-br from-gray-950 to-black min-h-screen py-16 text-gray-100 font-sans antialiased">
    <div class="max-w-8xl mx-auto px-6 sm:px-8 lg:px-12">
        <header class="flex flex-col sm:flex-row justify-between items-center mb-12 space-y-6 sm:space-y-0">
            <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-gray-200 via-gray-50 to-gray-200 tracking-tighter text-center sm:text-left drop-shadow-lg">
                {{ heading }}
            </h1>
            {% if role == 'seller' and show_actions %}
            <a href="{% url "create_product_page" %}" class="relative inline-flex items-center justify-center p-0.5 mb-2 me-2 overflow-hidden text-sm font-medium text-gray-900 rounded-full group bg-gradient-to-br from-purple-600 to-blue-500 group-hover:from-purple-600 group-hover:to-blue-500 hover:text-white dark:text-white focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800">
                <span class="relative px-5 py-2.5 transition-all ease-in duration-75 bg-white dark:bg-gray-900 rounded-full group-hover:bg-opacity-0 text-lg font-semibold">
                    Register New Product
                </span>
            </a>
            {% endif %}
        </header>

        <div class="bg-gray-900/50 backdrop-blur-lg border border-gray-800 rounded-[3rem] shadow-[0_20px_50px_rgba(8,_112,_184,_0.7)] p-8 mb-12">
            <form method="get" {% if show_actions %}action="{% url 'my_products_page' %}" {% else %}action="{% url 'portal' %}" {% endif %} class="flex flex-col lg:flex-row items-stretch lg:items-center gap-6">
                <div class="flex-1 relative">
                    <input type="text" id="searchBox" name="search" placeholder="Search Products..." value="{{ request.GET.search }}" class="w-full px-6 py-4 border-2 border-gray-700 rounded-full bg-gray-800/60 text-gray-50 placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all duration-300 shadow-inner">
                    <div class="absolute inset-y-0 right-0 pr-6 flex items-center pointer-events-none">
                        <svg class="h-6 w-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-6">
                    <div class="relative w-full sm:w-auto">
                        <select name="brand" class="appearance-none w-full px-6 py-4 border-2 border-gray-700 rounded-full bg-gray-800/60 text-gray-50 pr-12 focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all duration-300 shadow-inner">
                            <option value="">All Brands</option>
                            {% for brand in brands %}
                            <option value="{{ brand.brand_name }}" {% if brand.brand_name == selected_brand %}selected{% endif %}>
                                {{ brand.brand_name }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-6 text-gray-500">
                            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                    
                    <button type="submit" class="bg-gradient-to-r from-purple-600 to-blue-500 text-white font-bold px-8 py-4 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 w-full sm:w-auto hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-950 focus:ring-blue-500">
                        Filter
                    </button>
                    
                    {% if selected_brand or request.GET.search %}
                    <a href="{% url 'my_products_page' %}" class="text-purple-400 hover:text-purple-300 font-semibold whitespace-nowrap self-center transition-colors duration-200 text-sm">
                        Clear Filters
                    </a>
                    {% endif %}
                </div>
            </form>
        </div>

        <div id="productList" class="space-y-12">
            <div class="grid gap-10 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 [grid-auto-rows:1fr]">
                {% for product in products %}
                <div class="bg-gray-900/60 backdrop-blur-md border-2 border-gray-800 rounded-[2.5rem] shadow-[0_10px_30px_rgba(0,0,0,0.5)] overflow-hidden group hover:shadow-purple-500/30 transition-all duration-700 transform hover:-translate-y-3 flex flex-col justify-between h-full">
                    <a href="{% url 'product_details_page' product.product_id %}" class="block">
                        <div class="relative overflow-hidden">
                            <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="w-full h-64 object-cover rounded-t-[2.5rem] transition-transform duration-700 group-hover:scale-110">
                            <div class="absolute inset-0 bg-gradient-to-t from-gray-950/80 to-transparent"></div>
                        </div>
                    </a>
                    
                    <div class="p-8 flex flex-col justify-between flex-grow">
                        <div>
                            <a href="{% url 'product_details_page' product.product_id %}" class="block">
                                <h2 class="text-3xl font-extrabold text-white mb-3 leading-tight group-hover:text-purple-400 transition-colors duration-300">{{ product.product_name|title }}</h2>
                            </a>
                            <div class="text-gray-400 text-base mb-2">
                                <span class="font-semibold text-gray-500">SKU:</span> {{ product.sku }}
                            </div>
                            <div class="text-gray-400 text-base mb-2">
                                <span class="font-semibold text-gray-500">Owner:</span> {{ product.owner.user.username }}
                            </div>
                            <div class="text-gray-400 text-base mb-4">
                                <span class="font-semibold text-gray-500">Brand:</span> <span class="text-purple-400 font-bold">{{ product.brand.brand_name }}</span>
                            </div>
                            
                            <p class="text-gray-400 text-sm leading-relaxed overflow-hidden max-h-[4.5rem] mb-6">
                                {{ product.desc|truncatechars:100 }}
                            </p>
                            
                            {% if show_actions %}
                            <div class="mb-6">
                                <span class="font-semibold text-gray-500">Status:</span>
                                {% if product.status %}
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-green-500 text-white shadow-md">
                                    <svg class="w-3 h-3 mr-2 animate-pulse" fill="currentColor" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3"></circle></svg> Active
                                </span>
                                {% else %}
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-red-500 text-white shadow-md">
                                    <svg class="w-3 h-3 mr-2" fill="currentColor" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3"></circle></svg> Inactive
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        
                        {% if show_actions %}
                            <div class="mt-auto pt-6 border-t border-gray-800 flex flex-col sm:flex-row justify-between gap-4">
                                <a href="{% url 'edit_product_page' product.product_id %}" 
                                    class="flex-1 text-center font-bold text-sm px-6 py-3 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg
                                        bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-600 hover:to-amber-600">
                                    Update
                                </a>
                                <form action="{% url 'delete_product_page' product.product_id %}" method="POST" class="flex-1">
                                    {% csrf_token %}
                                    <button type="submit"
                                        onclick="return confirm('Are you sure you want to delete this product?')"
                                        class="w-full font-bold text-sm px-6 py-3 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg
                                            bg-gradient-to-r from-red-600 to-rose-600 text-white hover:from-red-700 hover:to-rose-700">
                                        Delete
                                    </button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {% if products.paginator.count > 6 %}
        {% if products.has_other_pages %}
        <div class="mt-16 flex flex-wrap justify-center items-center space-x-3 sm:space-x-4">
            {% if products.has_previous %}
            <a href="?page=1{% if selected_brand %}&brand={{ selected_brand }}{% endif %}" 
                class="ajax-page-link px-5 py-3 bg-gray-800/70 text-purple-400 rounded-full hover:bg-gray-700 transition-all duration-300 text-base font-semibold shadow-md">
                First
            </a>
            <a href="?page={{ products.previous_page_number }}{% if selected_brand %}&brand={{ selected_brand }}{% endif %}" 
                class="ajax-page-link px-5 py-3 bg-gray-800/70 text-purple-400 rounded-full hover:bg-gray-700 transition-all duration-300 text-base font-semibold shadow-md">
                Previous
            </a>
            {% endif %}
            <span class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-full text-base font-bold shadow-xl">
                Page {{ products.number }} of {{ products.paginator.num_pages }}
            </span>
            {% if products.has_next %}
            <a href="?page={{ products.next_page_number }}{% if selected_brand %}&brand={{ selected_brand }}{% endif %}" 
                class="ajax-page-link px-5 py-3 bg-gray-800/70 text-purple-400 rounded-full hover:bg-gray-700 transition-all duration-300 text-base font-semibold shadow-md">
                Next
            </a>
            <a href="?page={{ products.paginator.num_pages }}{% if selected_brand %}&brand={{ selected_brand }}{% endif %}" 
                class="ajax-page-link px-5 py-3 bg-gray-800/70 text-purple-400 rounded-full hover:bg-gray-700 transition-all duration-300 text-base font-semibold shadow-md">
                Last
            </a>
            {% endif %}
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Product listing page loaded.');
    });
</script>
<script src="static/js/index.js"></script>
{% endblock content %}
